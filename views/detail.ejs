<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="\main.css">
</head>
<body class="grey-bg">
    <%- include('nav.ejs') %>
    <div class="detail-bg">
        <h4 style="font-size: x-large; padding: 5px; margin: 0px; border-top: 1px solid #4a4a4a;
        border-bottom: 1px solid #4a4a4a;"><%= ê¸€ëª©ë¡.title %></h4>
        <p style="font-size: small;">ì‘ì„±ì:  
            <img style="width: 25px; height: 25px;" src="/image/<%= í”„ë¡œí•„ %>" onerror="this.src='/image/dinosaur.png'"/><%= ê¸€ëª©ë¡.ì‘ì„±ì %></p>
        <div class="img-box">
            <img src="<%= ì´ë¯¸ì§€ì£¼ì†Œ %>">
            <video src="<%= ë™ì˜ìƒì£¼ì†Œ %>" type="video/mp4" controls muted loop autoplay 
            playsinline preload="metadata" 
            style="width: 200px" onerror="this.style.display='none';">
            </video>
        </div>
        <p><%= ê¸€ëª©ë¡.content %></p>
        <div>
            <div class="like-box">
                <div>
                    <span name="like" class="like" data-postId="<%= ê¸€ëª©ë¡._id %>">ğŸ‘</span>
                    <p class="like" style="margin: 0px;"><%= ê¸€ëª©ë¡.like %></p>
                </div>
            </div>
        </div>
    </div> 

    <div class="comment">
        <form class="comment-write" action="/comment" method="POST">
            <input class="commentInput" id="send-input" name="comment" size="5">
            <span name="comment-push1" class="comment-push" id="send">ì‘ì„±</span>
        </form>
        <div id="comment-box">
            <%for (let i=0; i<ëŒ“ê¸€ëª©ë¡.length; i++){ %>
                <p style="text-align: left; margin-bottom: 30px; clear: both">
                    <div class="profile">
                        <div class="profileImage">
                            <img src="/image/<%= ëŒ“ê¸€ëª©ë¡[i].userprofile %>">
            
                        </div>
                        <div class="profile2">
                            <div class="profiletext"><%= ëŒ“ê¸€ëª©ë¡[i].username %></div>
                        </div>
                    </div>
                    <div class="profile3"><%= ëŒ“ê¸€ëª©ë¡[i].content %></div>
                    <span name="add" id="commentDel" data-id="<%= ëŒ“ê¸€ëª©ë¡[i]._id %>"
                        data-postId="<%= ëŒ“ê¸€ëª©ë¡[i].postId %>" data-userId="<%= ëŒ“ê¸€ëª©ë¡[i].userId %>">ğŸ—‘ï¸
                    </span>
                    <br>
                </p>
            <% }%>
        </div>
    </div>
    <div class="infomation" style="background-color:rgba(0, 0, 0, 0.2);">
        <p style="font-weight: bold; height: 10vh;">â›”ì•Œë¦¼â›”<br>
          <span style="color:red">1. (ëŒ“ê¸€ì‘ì„±, ì‚­ì œ, ì¢‹ì•„ìš”) ëŠ” ìƒˆë¡œê³ ì¹¨ í›„ ì ìš©ë¨<br></span>
        </p>
      </div>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script>
        var ì§€ê¸ˆëˆ„ë¥¸ì‘ì„±ê¸€id = '<%= ê¸€ëª©ë¡._id %>'
        var ì§€ê¸ˆëˆ„ë¥¸ì‘ì„±ê¸€ì´ë¦„ = '<%= ê¸€ëª©ë¡.title %>'
        var ì§€ê¸ˆëˆ„ë¥¸ì‘ì„±ê¸€ = '<%= ê¸€ëª©ë¡.content %>'
        var ì§€ìš¸ê±° 
        $(document).on("click","span[name='like']", function(e){
            var ë³´ë‚¼ê±° = {postid : ì§€ê¸ˆëˆ„ë¥¸ì‘ì„±ê¸€id,
            }
            $.post('/addlike', ë³´ë‚¼ê±°).then(()=> {
          })
        })
        var box = $(".profile2");
        $('.profile2').change(function(){
            console.log('ë³€ê²½')
        })
    
        document.querySelector('.comment-push').addEventListener('click', ()=>{
            var ëŒ“ê¸€ë‚´ìš© = $('#send-input').val();
            var ë³´ë‚¼ê±° = {
                parent : ì§€ê¸ˆëˆ„ë¥¸ì‘ì„±ê¸€id,
                content : ëŒ“ê¸€ë‚´ìš©,
            }
            fetch('/comment', {
            method : 'POST',
            async : false,
            headers : {
                'Content-Type' : 'application/json'
            },
            body : JSON.stringify(ë³´ë‚¼ê±°)
            })
            .then((r)=>r.text())
            .then((r)=>{
                location.reload();
            }) 
        })

        document.getElementById("send-input").addEventListener("keyup", function(event) {
            if (event.keyCode === 13) {
                var ëŒ“ê¸€ë‚´ìš© = $('#send-input').val();
                var ë³´ë‚¼ê±° = {
                    parent : ì§€ê¸ˆëˆ„ë¥¸ì‘ì„±ê¸€id,
                    content : ëŒ“ê¸€ë‚´ìš©,
                }
                fetch('/comment', {
                method : 'POST',
                async : false,
                headers : {
                    'Content-Type' : 'application/json'
                },
                body : JSON.stringify(ë³´ë‚¼ê±°)
                })
                .then((r)=>r.text())
                .then((r)=>{
                    location.reload();
            })
        }});


        $(document).on("click","span[name='add']", function(e){
            var ì§€ìš¸ê±° = {id : this.dataset.id,
            userId : this.dataset.userid}
            fetch('/deletee2', {
            method : 'POST',
            async : false,
            headers : {
                'Content-Type' : 'application/json'
            },
            body : JSON.stringify(ì§€ìš¸ê±°)
            })
            .then((r)=>r.text())
            .then((r)=>{
                location.reload();
            }) 
        }) 
        if(document.querySelector('.profile2').innerHTML.length>2){
            document.querySelector('.profile2').innerText.substr(0,3)
        }
    </script>
</body>
</html>